diff --git a/config b/config
index 1e442a7..e1c7ba0 100644
--- a/config
+++ b/config
@@ -1,3 +1,17 @@
 ngx_addon_name=ngx_http_allow_methods_module
-HTTP_MODULES="$HTTP_MODULES ngx_http_allow_methods_module"
-NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/ngx_http_allow_methods_module.c"
+
+EVAL_SRCS="$ngx_addon_dir/ngx_http_allow_methods_module.c"
+
+if test -n "$ngx_module_link"; then
+    ngx_module_type=HTTP
+    ngx_module_name=$ngx_addon_name
+    ngx_module_incs=
+    ngx_module_deps=
+    ngx_module_srcs="$EVAL_SRCS"
+    ngx_module_libs=
+
+    . auto/module
+else
+    HTTP_MODULES="$HTTP_MODULES $ngx_addon_name"
+    NGX_ADDON_SRCS="$NGX_ADDON_SRCS $EVAL_SRCS"
+fi
